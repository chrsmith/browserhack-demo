version: 2
jobs:
  build:
    docker:
      - image: circleci/node:7.10

    working_directory: ~/repo

    steps:
      - checkout
      # Install Pulumi and add to PATH.
      # https://circleci.com/docs/2.0/env-vars/
      - run: curl -L https://get.pulumi.com/ | bash -s -- --version 0.16.1
      - run:
          name: Add Pulumi to $PATH
          command: |
            echo 'export PATH=/home/circleci/.pulumi/bin:$PATH' >> $BASH_ENV
            source $BASH_ENV

      # Build, Lint, Test
      - run: npm install
      - run: npm run build
      - run: npm run lint

      # Update the stack
      - run: pulumi login
      - run: pulumi update -s browserhack-demo
